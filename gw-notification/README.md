# GW-Notification Service

Kafka consumer –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∫—Ä—É–ø–Ω—ã—Ö –¥–µ–Ω–µ–∂–Ω—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–∞—Ö —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ MongoDB.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üì® –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ Kafka
- üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ MongoDB —Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π
- ‚ö° Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–¥–æ 1000 msg/sec)
- üîÑ Retry –º–µ—Ö–∞–Ω–∏–∑–º —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
- üë∑ –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (worker pool)
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- üõ°Ô∏è Graceful shutdown
- üìù Structured logging (JSON)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
gw-notification/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ main.go                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ pkg/
‚îÇ   ‚îî‚îÄ‚îÄ utils.go                # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ storages/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ storage.go          # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ model.go            # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mongodb/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ connector.go    # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ methods.go      # –ú–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.go           # –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ defaults.go         # –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
‚îÇ   ‚îú‚îÄ‚îÄ kafka/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ consumer.go         # Kafka consumer
‚îÇ   ‚îî‚îÄ‚îÄ logger/
‚îÇ       ‚îî‚îÄ‚îÄ logger.go           # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–≥–µ—Ä–∞
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îî‚îÄ‚îÄ service_test.go         # Unit —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ go.mod
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ config.env                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ README.md
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.21+
- MongoDB 4.4+
- Kafka 2.8+

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd gpt/gw-notification
go mod download
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MongoDB

```bash
# –ó–∞–ø—É—Å–∫ MongoDB –≤ Docker
docker run --name mongodb-notification \
  -p 27017:27017 \
  -d mongo:7-jammy
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Kafka

```bash
# –ó–∞–ø—É—Å–∫ Zookeeper
docker run -d --name zookeeper \
  -p 2181:2181 \
  confluentinc/cp-zookeeper:latest

# –ó–∞–ø—É—Å–∫ Kafka
docker run -d --name kafka \
  -p 9092:9092 \
  -e KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181 \
  -e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://localhost:9092 \
  confluentinc/cp-kafka:latest
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `config.env`:

```env
# MongoDB
MONGO_URI=mongodb://localhost:27017
MONGO_DATABASE=notification_db
MONGO_COLLECTION=large_transfers

# Kafka
KAFKA_BROKERS=localhost:9092
KAFKA_TOPIC=large-transfers
KAFKA_GROUP_ID=notification-service-group

# Processing
BATCH_SIZE=100
WORKERS=10
FLUSH_INTERVAL=5s
```

## –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

```bash
# –°–±–æ—Ä–∫–∞
GOOS=linux GOARCH=amd64 go build -o main ./cmd

# –ó–∞–ø—É—Å–∫
./main -c config.env
```

### Docker –∑–∞–ø—É—Å–∫

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t gw-notification .

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run --env-file config.env gw-notification
```

## –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ Kafka

Consumer –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Ç–æ–ø–∏–∫ `large-transfers` –∏ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø–µ—Ä–µ–≤–æ–¥–∞—Ö >30,000 –≤–∞–ª—é—Ç—ã.

–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Kafka:
```json
{
  "user_id": 123,
  "type": "exchange",
  "from_currency": "USD",
  "to_currency": "EUR",
  "amount": 50000.00,
  "timestamp": "2024-02-02T15:04:05Z"
}
```

### 2. Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞

–°–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–∞–∫–µ—Ç–∞–º–∏ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

- **–†–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞**: 100 —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–±—Ä–æ—Å–∞**: 5 —Å–µ–∫—É–Ω–¥ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º**: 10 –≤–æ—Ä–∫–µ—Ä–æ–≤ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

### 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ MongoDB

–ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ MongoDB —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏:

```json
{
  "_id": ObjectId("..."),
  "user_id": 123,
  "type": "exchange",
  "from_currency": "USD",
  "to_currency": "EUR",
  "amount": 50000.00,
  "timestamp": "2024-02-02T15:04:05Z",
  "processed_at": "2024-02-02T15:04:06Z",
  "status": "processed"
}
```

### 4. –ò–Ω–¥–µ–∫—Å—ã MongoDB

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã:
- `user_id` - –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- `timestamp` (desc) - –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `processed_at` (desc) - –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `type` - –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø—É –æ–ø–µ—Ä–∞—Ü–∏–∏
- `status` - –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É
- `amount` (desc) - –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ —Å—É–º–º–µ

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

- **Throughput**: 1000 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫
- **Latency**: <100ms –Ω–∞ –ø–∞–∫–µ—Ç
- **Availability**: 99.9%

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

1. **Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
2. **Worker pool** - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∫–æ–º–º–∏—Ç—ã** - –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º —á—Ç–µ–Ω–∏–µ
4. **Connection pooling** - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
5. **–ò–Ω–¥–µ–∫—Å—ã MongoDB** - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–≤–æ–¥–∏—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥:

```json
{
  "timestamp": "2024-02-02 15:04:05",
  "level": "info",
  "message": "Consumer Statistics: Processed=1500, Failed=2, Rate=250.5 msg/s, Uptime=6s"
}
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### Retry –º–µ—Ö–∞–Ω–∏–∑–º

–ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ MongoDB:
- **–ü–æ–ø—ã—Ç–∫–∏**: 3 (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- **–ó–∞–¥–µ—Ä–∂–∫–∞**: 1s –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –≤—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

### –°—Ç–∞—Ç—É—Å—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏

- `processed` - —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
- `failed` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å

## Graceful Shutdown

–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–∏–≥–Ω–∞–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (SIGINT, SIGTERM):

1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á—Ç–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏
3. –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –ø–∞–∫–µ—Ç—ã
4. –ó–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è Kafka consumer
5. –ó–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è MongoDB connection
6. –í—ã–≤–æ–¥–∏—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è: 30 —Å–µ–∫—É–Ω–¥ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

Structured logging –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ:

```json
{
  "timestamp": "2024-02-02 15:04:05",
  "level": "info",
  "message": "Flushed batch: size=100, duration=45ms, rate=2222.22 msg/s"
}
```

–£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:
- `debug` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `info` - –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- `warn` - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- `error` - –æ—à–∏–±–∫–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
go test ./... -v

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–∞–∫–µ—Ç
go test ./tests -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
go test ./... -cover
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Kafka

```bash
# –ò—Å–ø–æ–ª—å–∑—É—è kafka-console-producer
docker exec -it kafka kafka-console-producer \
  --broker-list localhost:9092 \
  --topic large-transfers

# –í—Å—Ç–∞–≤—å—Ç–µ JSON –∏ –Ω–∞–∂–º–∏—Ç–µ Enter:
{"user_id":123,"type":"deposit","from_currency":"USD","to_currency":"USD","amount":50000,"timestamp":"2024-02-02T15:04:05Z"}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ MongoDB

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB
docker exec -it mongodb-notification mongosh

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ë–î
use notification_db

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤
db.large_transfers.find().pretty()

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
db.large_transfers.aggregate([
  {
    $group: {
      _id: null,
      total: { $sum: 1 },
      avgAmount: { $avg: "$amount" },
      totalAmount: { $sum: "$amount" }
    }
  }
])
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|----------|--------------|
| `BATCH_SIZE` | –†–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞ –¥–ª—è batch –æ–±—Ä–∞–±–æ—Ç–∫–∏ | 100 |
| `WORKERS` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ | 10 |
| `FLUSH_INTERVAL` | –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–±—Ä–æ—Å–∞ –ø–∞–∫–µ—Ç–∞ | 5s |
| `MAX_PROCESSING_TIME` | –ú–∞–∫—Å. –≤—Ä–µ–º—è graceful shutdown | 30s |
| `RETRY_ATTEMPTS` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–µ | 3 |
| `RETRY_DELAY` | –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ | 1s |

### Kafka –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|----------|--------------|
| `KAFKA_BROKERS` | –°–ø–∏—Å–æ–∫ –±—Ä–æ–∫–µ—Ä–æ–≤ | localhost:9092 |
| `KAFKA_TOPIC` | –¢–æ–ø–∏–∫ –¥–ª—è —á—Ç–µ–Ω–∏—è | large-transfers |
| `KAFKA_GROUP_ID` | ID –≥—Ä—É–ø–ø—ã consumer | notification-service-group |
| `KAFKA_MIN_BYTES` | –ú–∏–Ω. —Ä–∞–∑–º–µ—Ä batch | 1 |
| `KAFKA_MAX_BYTES` | –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä batch | 10MB |
| `KAFKA_MAX_WAIT` | –ú–∞–∫—Å. –æ–∂–∏–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π | 500ms |

### MongoDB –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|----------|--------------|
| `MONGO_URI` | URI –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è | mongodb://localhost:27017 |
| `MONGO_DATABASE` | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | notification_db |
| `MONGO_COLLECTION` | –ò–º—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ | large_transfers |
| `MONGO_MAX_POOL_SIZE` | –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π | 100 |
| `MONGO_MIN_POOL_SIZE` | –ú–∏–Ω. —Ä–∞–∑–º–µ—Ä –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π | 10 |

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### Consumer —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- –í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π
- –í—Å–µ–≥–æ –æ—à–∏–±–æ–∫
- –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ (msg/s)
- –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã (uptime)

### Storage —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –≤ –ë–î
- –°—Ä–µ–¥–Ω—è—è —Å—É–º–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞
- –û–±—â–∞—è —Å—É–º–º–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
- –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

## –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

–ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ —Å–µ—Ä–≤–∏—Å–∞:
- –ö–∞–∂–¥—ã–π –∏–Ω—Å—Ç–∞–Ω—Å –±—É–¥–µ—Ç –≤ –æ–¥–Ω–æ–π Kafka consumer group
- Kafka –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏ –º–µ–∂–¥—É –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏
- MongoDB –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –∑–∞–ø–∏—Å—å

### –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ –æ–¥–Ω–æ–º –∏–Ω—Å—Ç–∞–Ω—Å–µ:
- –£–≤–µ–ª–∏—á–∏—Ç—å `WORKERS` (–±–æ–ª—å—à–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤)
- –£–≤–µ–ª–∏—á–∏—Ç—å `BATCH_SIZE` (–±–æ–ª—å—à–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ø–∞–∫–µ—Ç–µ)
- –£–≤–µ–ª–∏—á–∏—Ç—å `MONGO_MAX_POOL_SIZE` (–±–æ–ª—å—à–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)

## Troubleshooting

### Kafka connection refused

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- Kafka –∑–∞–ø—É—â–µ–Ω: `docker ps | grep kafka`
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ brokers –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- Firewall –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ä—Ç 9092

### MongoDB connection timeout

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- MongoDB –∑–∞–ø—É—â–µ–Ω: `docker ps | grep mongo`
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π URI –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- Firewall –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ä—Ç 27017

### –ù–∏–∑–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:
- –£–≤–µ–ª–∏—á–∏—Ç—å `WORKERS`
- –£–≤–µ–ª–∏—á–∏—Ç—å `BATCH_SIZE`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã MongoDB
- –£–≤–µ–ª–∏—á–∏—Ç—å `MONGO_MAX_POOL_SIZE`

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

### gw-currency-wallet

–°–µ—Ä–≤–∏—Å wallet –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Kafka –ø—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö >30,000:
- –î–µ–ø–æ–∑–∏—Ç >30,000
- –í—ã–≤–æ–¥ >30,000
- –û–±–º–µ–Ω >30,000

### Kafka —Ç–æ–ø–∏–∫

–¢–æ–ø–∏–∫: `large-transfers`
–§–æ—Ä–º–∞—Ç: JSON
Retention: 7 –¥–Ω–µ–π (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ Kafka)

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è Prometheus (–±—É–¥—É—â–µ–µ)

- `notification_messages_processed_total`
- `notification_messages_failed_total`
- `notification_processing_rate`
- `notification_batch_size`
- `notification_processing_duration_seconds`

### Health check

Ping MongoDB –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
